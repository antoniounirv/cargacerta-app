{
  "entities": {
    "Empresa": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Empresa",
      "type": "object",
      "description": "Represents a company registered in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Empresa entity."
        },
        "razaoSocial": {
          "type": "string",
          "description": "The official registered name of the company."
        },
        "cnpj": {
          "type": "string",
          "description": "The company's CNPJ (Brazilian corporate tax ID)."
        },
        "email": {
          "type": "string",
          "description": "The company's email address.",
          "format": "email"
        },
        "senhaHash": {
          "type": "string",
          "description": "Hashed password for the company's account.  Do not store plain text passwords."
        },
        "planoId": {
          "type": "string",
          "description": "Reference to Plano. (Relationship: Empresa 1:1 Plano)"
        },
        "dataCadastro": {
          "type": "string",
          "description": "The date when the company was registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "razaoSocial",
        "cnpj",
        "email",
        "senhaHash",
        "planoId",
        "dataCadastro"
      ]
    },
    "Plano": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plano",
      "type": "object",
      "description": "Represents a subscription plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Plano entity."
        },
        "nome": {
          "type": "string",
          "description": "The name of the subscription plan."
        },
        "preco": {
          "type": "number",
          "description": "The price of the subscription plan."
        },
        "limiteMotoristas": {
          "type": "number",
          "description": "The limit of drivers allowed for this plan."
        },
        "limiteCargas": {
          "type": "number",
          "description": "The limit of loads allowed for this plan."
        },
        "descricao": {
          "type": "string",
          "description": "A description of the subscription plan."
        }
      },
      "required": [
        "id",
        "nome",
        "preco",
        "limiteMotoristas",
        "limiteCargas",
        "descricao"
      ]
    },
    "Motorista": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Motorista",
      "type": "object",
      "description": "Represents a driver.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Motorista entity."
        },
        "nome": {
          "type": "string",
          "description": "The name of the driver."
        },
        "cpf": {
          "type": "string",
          "description": "The driver's CPF (Brazilian individual tax ID)."
        },
        "telefone": {
          "type": "string",
          "description": "The driver's phone number."
        },
        "empresaId": {
          "type": "string",
          "description": "Reference to Empresa. (Relationship: Empresa 1:N Motorista)"
        }
      },
      "required": [
        "id",
        "nome",
        "cpf",
        "telefone",
        "empresaId"
      ]
    },
    "Carga": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Carga",
      "type": "object",
      "description": "Represents a load.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Carga entity."
        },
        "origem": {
          "type": "string",
          "description": "The origin of the load."
        },
        "destino": {
          "type": "string",
          "description": "The destination of the load."
        },
        "status": {
          "type": "string",
          "description": "The status of the load."
        },
        "motoristaId": {
          "type": "string",
          "description": "Reference to Motorista. (Relationship: Motorista 1:N Carga)"
        },
        "empresaId": {
          "type": "string",
          "description": "Reference to Empresa. (Relationship: Empresa 1:N Carga)"
        }
      },
      "required": [
        "id",
        "origem",
        "destino",
        "status",
        "motoristaId",
        "empresaId"
      ]
    },
    "Documento": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Documento",
      "type": "object",
      "description": "Represents a document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Documento entity."
        },
        "nomeArquivo": {
          "type": "string",
          "description": "The name of the document file."
        },
        "url": {
          "type": "string",
          "description": "The URL where the document is stored.",
          "format": "uri"
        },
        "motoristaId": {
          "type": "string",
          "description": "Reference to Motorista. (Relationship: Motorista 1:N Documento)"
        },
        "empresaId": {
          "type": "string",
          "description": "Reference to Empresa. (Relationship: Empresa 1:N Documento)"
        }
      },
      "required": [
        "id",
        "nomeArquivo",
        "url",
        "motoristaId",
        "empresaId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/empresas/{empresaId}",
        "definition": {
          "entityName": "Empresa",
          "schema": {
            "$ref": "#/backend/entities/Empresa"
          },
          "description": "Stores company information.  Indexed by empresaId.",
          "params": [
            {
              "name": "empresaId",
              "description": "The unique identifier of the company."
            }
          ]
        }
      },
      {
        "path": "/planos/{planoId}",
        "definition": {
          "entityName": "Plano",
          "schema": {
            "$ref": "#/backend/entities/Plano"
          },
          "description": "Stores subscription plan details. Indexed by planoId.",
          "params": [
            {
              "name": "planoId",
              "description": "The unique identifier of the subscription plan."
            }
          ]
        }
      },
      {
        "path": "/empresas/{empresaId}/motoristas/{motoristaId}",
        "definition": {
          "entityName": "Motorista",
          "schema": {
            "$ref": "#/backend/entities/Motorista"
          },
          "description": "Stores driver information for a specific company. Includes denormalized 'empresaId' for authorization independence.",
          "params": [
            {
              "name": "empresaId",
              "description": "The unique identifier of the company."
            },
            {
              "name": "motoristaId",
              "description": "The unique identifier of the driver."
            }
          ]
        }
      },
      {
        "path": "/empresas/{empresaId}/cargas/{cargaId}",
        "definition": {
          "entityName": "Carga",
          "schema": {
            "$ref": "#/backend/entities/Carga"
          },
          "description": "Stores load information for a specific company. Includes denormalized 'empresaId' for authorization independence.",
          "params": [
            {
              "name": "empresaId",
              "description": "The unique identifier of the company."
            },
            {
              "name": "cargaId",
              "description": "The unique identifier of the load."
            }
          ]
        }
      },
      {
        "path": "/empresas/{empresaId}/documentos/{documentoId}",
        "definition": {
          "entityName": "Documento",
          "schema": {
            "$ref": "#/backend/entities/Documento"
          },
          "description": "Stores document information for a specific company. Includes denormalized 'empresaId' for authorization independence.",
          "params": [
            {
              "name": "empresaId",
              "description": "The unique identifier of the company."
            },
            {
              "name": "documentoId",
              "description": "The unique identifier of the document."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the multi-tenant CargoCerta application, ensuring data isolation and authorization independence. The core principle is to store each entity (Empresa, Plano, Motorista, Carga, Documento) in dedicated collections, and for entities related to a company, we enforce path-based ownership. This design avoids the need for `get()` calls in security rules, enabling atomic operations and easier debugging.\n\n**Authorization Independence and Multi-Tenancy:**\nEach entity that belongs to a company (`Motorista`, `Carga`, `Documento`) is stored in a path that includes the `empresaId`. This explicit path-based ownership ensures that access control can be enforced directly in the security rules without needing to fetch the parent `Empresa` document.  All `list` operations are secure because the company ID is embedded in the path.\n\n**Collections Design:**\n- `/empresas`: Contains company profile information, including subscription plan details.\n- `/planos`: Contains available subscription plans.\n- `/empresas/{empresaId}/motoristas`: Contains drivers associated with a specific company. The `empresaId` is denormalized into each `Motorista` document.\n- `/empresas/{empresaId}/cargas`: Contains loads associated with a specific company. The `empresaId` is denormalized into each `Carga` document.\n- `/empresas/{empresaId}/documentos`: Contains documents associated with a specific company. The `empresaId` is denormalized into each `Documento` document.\n\nThis structure allows for efficient querying and ensures that each company's data is isolated and secure."
  }
}